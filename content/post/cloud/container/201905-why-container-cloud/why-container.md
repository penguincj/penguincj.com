+++
title = "Why 容器云"
subtitle = "容器云解决大量项目构建运营环境的效率问题"
summary = "容器云解决大量项目构建运营环境的效率问题"
date = 2019-05-07
draft = false

tags = ["Docker", "Cloud"]
+++

人们对云计算提出了更高的要求，为大量项目构建运营环境的效率问题，缩短新业务的上线部署时间，大规模的计算机房快速迁移需求；提高服务器资源的利用率，同时确保相同的性能和可用性，又有降低成本的需求。相较于传统的虚拟化解决方案，容器云可以较好的实现上述目标。

容器云的核心功能：

- 快速扩容
- 智能调度和编排
- 弹性伸缩


## 快速扩容

- 扩容速度：
	- VM - 扩容20个实例需要4分钟（扩容完成后需要再执行服务发布）
	- docker - 扩容20个实例仅需30s，秒级别扩容（扩容完成即服务启动）
- 扩容速度提高 8~12倍
- 节约了用户手动操作申请/发布的成本



## 智能调度

调度系统是云集群的中央处理器，要解决的核心问题是为容器选择合适的宿主机。有如下的指标：

- 资源利用率，提高整体物理集群的资源利用率
- 业务可用性保障：业务容器容灾能力、保障运行业务的稳定高可用
- 并发调度能力：调度系统请求处理能力的体现


### 资源最大化利用

- 按CPU/Mem/IO等类型对服务进行调度，最大化资源利用
- 业务按需使用资源，提升资源利用率

### 混布与独占

- 在线服务与离线任务混布
- 重要业务资源池独占

### 容器编排

- 有调用关系的多个服务实例，优先部署到相同/相近的宿主机上
- 同服务实例打散，分布到不同宿主机上，提高服务可用性
- 高负载容器，自动迁移到低负载宿主机
- 自动化容器实例健康检查，异常实例自动迁移

### 调度计算

通过先过滤filter之后排序打分rank的方式找到最优的部署位置。

在一批宿主机中先过滤掉超售的，然后考虑到打散、混部、减少碎片和负载均衡之后找到合适的宿主机

### 调度SLA（Service Level Agreement）

- 高可用：99.999
- 调度成功率：99.99
- 并发调度：单机并发处理200+，并发调度机器1000+
- 低延迟：TCP90 63ms
- HA：分布式调度，横向扩展，多IDC部署容灾
- 监控报警：Falcon


## 弹性收缩

**周期收缩**

根据设定时间段伸缩（适合秒杀/直播等业务）

**监控伸缩**

- 根据QPS/CPU等触发条件伸缩
- 线性可扩展的无状态服务


**服务画像**

针对数据建模，描绘服务特征：

- 服务画像：仿照用户画像，根据服务数据，抽取服务Tag
	- QPS特征（高峰时段、QPS max/min等）
	- 资源利用率
	- CPU密集型 or IO密集型


基于历史数据建模的服务画像可以做服务特征值的预测，比如QPS的预测：

- QPS预测：RNN LSTM
- 即使监控数据源完全不可用，无数据，也能较准确的扩缩容


## 异常处理

- 监控数据异常，怎么办？会不会因监控值偏低而一直缩容？
- 监控数据有延迟，怎么办？
- 监控数据没了，怎么办？

通过数据无关的缩容退避+熔断机制来保证异常情况下的正常运行：

- 针对监控数据偏低（异常）而触发持续缩容
- 数据无关，不关心数据是否异常
- 如果连续缩容，那么缩容速度会越来越慢 —> 退避
- 如果连续缩容次数超过阈值，一段时间内禁止缩容 —> 熔断
